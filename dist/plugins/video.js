!function(){"use strict";!function(o,e){void 0===e&&(e={});var i=e.insertAt;if(o&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===i&&t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n),n.styleSheet?n.styleSheet.cssText=o:n.appendChild(document.createTextNode(o))}}(".rm-block-ref span.bp3-icon-video {\n  display: inline-flex;\n}\n"),function(o,e,i={}){const{maxCount:t=5}=i;window.roamEnhance.loaded.add(o),function(o,e="",i=10){let t=0;!async function o(n){var l;try{await n()}catch(c){console.log(`[${e}] error`,{e:c}),t<i?setTimeout((()=>(t++,o(n))),2e3):(console.log(`[${e}] error 超出次数加载失败，停止重试`),null===(l=window.roam42)||void 0===l||l.help.displayMessage(`${e}加载失败`,2e3))}}(o)}((async()=>{await e({ctx:window.roamEnhance._plugins[o],name:o,options:window.roamEnhance._plugins[o].options||{}})}),o,t)}("video",(({ctx:o,name:e})=>{const i=(new Map).set(/https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*)/,((o,e)=>`https://player.bilibili.com/player.html?bvid=${e}&page=1&high_quality=1&as_wide=1&allowfullscreen=true`)).set(/https\:\/\/www\.ixigua\.com\/([^(\s\)\})]*)/,((o,e)=>`https://www.ixigua.com/iframe/${e}?autoplay=0&amp;startTime=0`)).set(/https\:\/\/v\.youku\.com\/v_show\/id_([^(\s\)\})]*)\.html/,((o,e)=>`https://player.youku.com/embed/${e}`)).set(/https\:\/\/v\.qq\.com\/x\/page\/([^(\s\)\})]*).html/,((o,e)=>`https://v.qq.com/txp/iframe/player.html?vid=${e}`));function t(o){const e=[...i.keys()].find((e=>e.test(o)));if(e){const t=o.match(e);return[i.get(e)(...t),e]}return[]}async function n(o){const e=o.closest("div.rm-block__input").id,i=window.roamEnhance.utils.getBlockUidFromId(e);return(await window.roam42.common.getBlockInfoByUID(i))[0][0]}o.resetVideoBlock=async function(o){var e;const i=null===(e=[...o.closest("div.rm-block__input").querySelectorAll(".bp3-icon-reset")])||void 0===e?void 0:e.indexOf(o),{string:t,uid:l}=await n(o);let c=0;const a=t.replace(/\{\{videoo\:\s*(.*?)\}\}/g,((o,e)=>{const t=i===c?e:o;return c++,t}));o.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((o=>o.remove())),await window.roam42.common.updateBlock(l,a)},o.focusBlock=o=>{window.roam42.common.simulateMouseClick(o.closest("div.rm-block__input"))},document.arrive(".roam-app div.rm-block__input button",{existing:!0},(async function(o){var i,l;if("videoo"===o.innerText){const c=null===(i=[...o.closest("div.rm-block__input").querySelectorAll("button")])||void 0===i?void 0:i.filter((o=>"videoo"===o.innerText)).indexOf(o),{string:a}=await n(o),r=null===(l=a.match(/\{\{videoo\:\s*(.*?)\}\}/g))||void 0===l?void 0:l[c];if(r){const[i]=t(r);o.outerHTML=`<div class="rm-iframe__spacing-wrapper rm-video-player__spacing-wrapper"><div class="rm-iframe__container rm-video-player__container hoverparent"><div class="hoveronly"><button onclick="window.roamEnhance._plugins['${e}'].focusBlock(this)" class="bp3-button bp3-small bp3-icon-standard bp3-icon-edit bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button><button onclick="window.roamEnhance._plugins['${e}'].resetVideoBlock(this);" style="position: absolute; right: 25px; top: 0; z-index: 10;" class="bp3-button bp3-small bp3-icon-standard bp3-icon-reset bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button></div><iframe class="rm-video-player" style="width: 100%; height: 100%; pointer-events: auto;" src="${i}" frameborder="no" allowfullscreen="" sandbox="allow-top-navigation-by-user-activation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div></div>`}}})),document.arrive(".roam-app div.rm-block__input a",{existing:!0},(async function(o){if(o.href){const[e,i]=t(o.href);if(i){const e=document.createElement("template");e.innerHTML='<span class="bp3-button bp3-minimal bp3-icon-video bp3-small dont-focus-block" tabindex="0"></span>',e.content.firstChild.onclick=async function(o){var e;const t=o.target,l=null===(e=[...t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video")])||void 0===e?void 0:e.indexOf(t),{string:c,uid:a}=await n(t),r=new RegExp(`(?<!(\\{\\{videoo\\:\\s*))\\[([^(\\[\\])]*?)\\]\\((${i.toString().slice(1,-1)})\\)`,"g");let s=0,d=c.replace(r,(o=>l===s++?`{{videoo: ${o}}}`:o));d!==c?(t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((o=>o.remove())),window.roam42.common.updateBlock(a,d)):(s=0,d=c.replace(new RegExp(`(?<!(\\{\\{videoo\\:\\s*))(${i.toString().slice(1,-1)})`,"g"),(o=>l===s++?`{{videoo: ${o}}}`:o)),d!==c&&(t.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((o=>o.remove())),window.roam42.common.updateBlock(a,d)))},o.before(e.content.firstChild)}}}))})),"1=[xxx](https://www.bilibili.com/video/BV1oX4y137Eq) =\n2= https://www.bilibili.com/video/BV1Cz4y117rB =".match(/(\[(?:[^(\[\])]*)\]\(https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*)\))|(https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*))/g)}();
