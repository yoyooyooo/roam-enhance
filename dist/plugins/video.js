!function(){"use strict";!function(o,e){void 0===e&&(e={});var t=e.insertAt;if(o&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===t&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=o:n.appendChild(document.createTextNode(o))}}(".rm-block-ref span.bp3-icon-video {\n  display: inline-flex;\n}\n"),function(o,e,t={}){const{maxCount:i=5}=t;window.roamEnhance.loaded.add(o),function(o,e="",t=10){let i=0;!async function o(n){var l,a;try{await n()}catch(c){console.log(`[${e}] error`,{e:c}),i<t?setTimeout((()=>(i++,o(n))),2e3):(console.log(`[${e}] error 超出次数加载失败，停止重试`),null===(a=null===(l=window.roam42)||void 0===l?void 0:l.help)||void 0===a||a.displayMessage(`${e}加载失败`,2e3))}}(o)}((async()=>{await e({ctx:window.roamEnhance._plugins[o],name:o,options:window.roamEnhance._plugins[o].options||{}})}),o,i)}("video",(({ctx:o,name:e})=>{const t=(new Map).set(/https\:\/\/www\.bilibili\.com\/video\/([^(\s\)\})]*)/,((o,e)=>`https://player.bilibili.com/player.html?bvid=${e}&page=1&high_quality=1&as_wide=1&allowfullscreen=true`)).set(/https\:\/\/www\.ixigua\.com\/([^(\s\)\})]*)/,((o,e)=>`https://www.ixigua.com/iframe/${e}?autoplay=0&amp;startTime=0`)).set(/https\:\/\/v\.youku\.com\/v_show\/id_([^(\s\)\})]*)\.html/,((o,e)=>`https://player.youku.com/embed/${e}`)).set(/https\:\/\/v\.qq\.com\/x\/page\/([^(\s\)\})]*).html/,((o,e)=>`https://v.qq.com/txp/iframe/player.html?vid=${e}`));function i(o){const e=[...t.keys()].find((e=>e.test(o)));if(e){const i=o.match(e);return[t.get(e)(...i),e]}return[]}async function n(o){const e=o.closest("div.rm-block__input").id,t=window.roamEnhance.utils.getBlockUidFromId(e);return(await window.roam42.common.getBlockInfoByUID(t))[0][0]}o.resetVideoBlock=async function(o){var e;const t=null===(e=[...o.closest("div.rm-block__input").querySelectorAll(".bp3-icon-reset")])||void 0===e?void 0:e.indexOf(o),{string:i,uid:l}=await n(o);let a=0;const c=i.replace(/\{\{videoo\:\s*(.*?)\}\}/g,((o,e)=>{const i=t===a?e:o;return a++,i}));o.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((o=>o.remove())),await window.roam42.common.updateBlock(l,c)},o.focusBlock=o=>{window.roam42.common.simulateMouseClick(o.closest("div.rm-block__input"))},document.arrive(".roam-app div.rm-block__input button",{existing:!0},(async function(o){var t,l;if("videoo"===o.innerText){const a=null===(t=[...o.closest("div.rm-block__input").querySelectorAll("button")])||void 0===t?void 0:t.filter((o=>"videoo"===o.innerText)).indexOf(o),{string:c}=await n(o),r=null===(l=c.match(/\{\{videoo\:\s*(.*?)\}\}/g))||void 0===l?void 0:l[a];if(r){const[t]=i(r);o.outerHTML=`<div class="rm-iframe__spacing-wrapper rm-video-player__spacing-wrapper"><div class="rm-iframe__container rm-video-player__container hoverparent"><div class="hoveronly"><button onclick="window.roamEnhance._plugins['${e}'].focusBlock(this)" class="bp3-button bp3-small bp3-icon-standard bp3-icon-edit bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button><button onclick="window.roamEnhance._plugins['${e}'].resetVideoBlock(this);" style="position: absolute; right: 25px; top: 0; z-index: 10;" class="bp3-button bp3-small bp3-icon-standard bp3-icon-reset bp3-minimal rm-iframe__edit-btn rm-video-player__edit-btn" content=""></button></div><iframe class="rm-video-player" style="width: 100%; height: 100%; pointer-events: auto;" src="${t}" frameborder="no" allowfullscreen="" sandbox="allow-top-navigation-by-user-activation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div></div>`}}})),document.arrive(".roam-app div.rm-block__input a",{existing:!0},(async function(o){if(o.href){const[e,t]=i(o.href);if(t){const e=document.createElement("template");e.innerHTML='<span class="bp3-button bp3-minimal bp3-icon-video bp3-small dont-focus-block" tabindex="0"></span>',e.content.firstChild.onclick=async function(o){var e;const i=o.target,l=null===(e=[...i.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video")])||void 0===e?void 0:e.indexOf(i),{string:a,uid:c}=await n(i),r=new RegExp(`(?<!(\\{\\{videoo\\:\\s*))\\[([^(\\[\\])]*?)\\]\\((${t.toString().slice(1,-1)})\\)`,"g");let s=0,d=a.replace(r,(o=>l===s++?`{{videoo: ${o}}}`:o));d!==a?(i.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((o=>o.remove())),window.roam42.common.updateBlock(c,d)):(s=0,d=a.replace(new RegExp(`(?<!(\\{\\{videoo\\:\\s*))(${t.toString().slice(1,-1)})`,"g"),(o=>l===s++?`{{videoo: ${o}}}`:o)),d!==a&&(i.closest("div.rm-block__input").querySelectorAll(".bp3-icon-video").forEach((o=>o.remove())),window.roam42.common.updateBlock(c,d)))},o.before(e.content.firstChild)}}}))}))}();
